generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  email         String    @unique
  password      String
  name          String
  role          String    @default("user")
  image         String?   // User profile image
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  projects      Project[]
  articles      Article[]
}

model Project {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  title         String
  slug          String    @unique
  description   String?
  // Using Json type for complex nested structures from projectDescriptions.ts
  overview      String?
  introduction  String?
  purposeAndGoal String?
  spotlight     Json?     // { title, sections: { overview, challenge, solution, keyTakeaway } }
  currentStatus String?
  technicalLessons String[]
  nonTechnicalLessons String[]
  impact        String?
  liveUrl       String?

  images        Json?     // [{ imgSrc, width, height }]
  icons         Json?     // [{ name, component, color }]
  features      String[]
  requirements  String[]
  approach      String[]
  challenges    Json?     // Array of challenge objects
  apiEndpoints  Json?

  metaDescription   String?
  metaKeywords      String[]
  ogTitle           String?
  ogDescription     String?
  ogImage           String?
  schemaMarkup      Json?

  authorId      String    @db.ObjectId
  author_user   User      @relation(fields: [authorId], references: [id], onDelete: Cascade)

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([authorId])
}

model Article {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  title         String
  slug          String    @unique
  content       String
  excerpt       String
  tags          String[]
  featured      Boolean   @default(false)
  published     Boolean   @default(false)
  readTime      String?
  image         String?   // Cover image URL

  metaDescription   String?
  metaKeywords      String[]
  ogTitle           String?
  ogDescription     String?
  ogImage           String?
  schemaMarkup      Json?

  authorId      String    @db.ObjectId
  author_user   User      @relation(fields: [authorId], references: [id], onDelete: Cascade)

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([authorId])
  @@index([published])
}

model Session {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  sessionToken  String    @unique
  userId        String    @db.ObjectId
  expires       DateTime
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model VerificationToken {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  identifier    String
  token         String    @unique
  expires       DateTime

  @@unique([identifier, token])
}
